<!--
// Copyright (c) 2009 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
//
// Copyright (c) 2010 Jacopo Corbetta
-->
<html>
<head>

<script>

//////////////////////////////////////////////////////////////////////
//
// This background page holds the selected options and provides them
// to the other scripts when requested
//////////////////////////////////////////////////////////////////////

var baseGmailUrl = "https://mail.google.com/";
var gmailUrlSuffix = "mail/?extsrc=mailto&url=";

function makeGmailDomainUrl() {
  var gmailUrl = baseGmailUrl;
  var domainName = window.localStorage["domainName"];
  if ((typeof domainName != "undefined") && (domainName != "")) {
    gmailUrl += "a/" + domainName + "/";
  }
  gmailUrl += gmailUrlSuffix;
//  alert("GmailUrl - " + gmailUrl);
  return gmailUrl;
}

// Send message to the mailto script to update its cached gmail url and other options.
chrome.extension.onConnect.addListener(function(port) {
  if (port.name != "GmailUrlConn") {
  // Not the mailto content script, so do not want to talk to this port. 
  } else {
    port.onMessage.addListener(function(msg) {
    if (msg.req == "OptionsPlease") {
      port.postMessage({gmailDomainUrl: makeGmailDomainUrl(), windowOptions: window.localStorage["gmail_window_options"]});
    } else {
      console.log("Unsupported req on valid port");
    }
    });
  }
});



</script>
</head>
<body>
	<form>
		<textarea id="aux_textarea">
	</form>
</body>
</html>
